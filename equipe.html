<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Equipe & Afiliados</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
    --bg1:#020617;
    --bg2:#0f172a;
    --card:rgba(255,255,255,0.08);
    --green:#22c55e;
}

*{ box-sizing:border-box; }

body{
    margin:0;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,Arial;
    background:linear-gradient(180deg,var(--bg1),var(--bg2));
    color:#fff;
    min-height:100vh;
}

.container{
    max-width:420px;
    margin:auto;
    padding:24px 16px 40px;
}

h1{
    font-size:1.6rem;
    margin-bottom:20px;
    font-weight:700;
    text-align:center;
}

.card{
    background:var(--card);
    backdrop-filter:blur(10px);
    border-radius:22px;
    padding:20px;
    margin-bottom:18px;
    box-shadow:0 10px 25px rgba(0,0,0,0.35);
}

.card h2{
    font-size:1.15rem;
    margin-bottom:12px;
}

.stat{
    display:flex;
    justify-content:space-between;
    align-items:center;
    font-size:1rem;
    padding:8px 0;
    border-bottom:1px solid rgba(255,255,255,0.08);
}

.stat:last-child{ border-bottom:none; }

input{
    width:100%;
    padding:15px;
    border-radius:16px;
    border:none;
    margin-top:10px;
    text-align:center;
    font-size:0.95rem;
    background:#020617;
    color:#fff;
}

button{
    width:100%;
    padding:15px;
    margin-top:12px;
    border:none;
    border-radius:18px;
    background:var(--green);
    color:#000;
    font-size:1rem;
    font-weight:700;
    cursor:pointer;
}

button:active{ transform:scale(0.98); }

.small-text{
    font-size:0.85rem;
    opacity:0.85;
    line-height:1.5;
}

hr{
    border:none;
    height:1px;
    background:rgba(255,255,255,0.12);
    margin:16px 0;
}
</style>
</head>

<body>

<div class="container">

    <h1>ü§ù Programa de Indica√ß√£o</h1>

    <div class="card">
        <p class="small-text"><strong>Seu c√≥digo de convite</strong></p>
        <h2 id="userId">---</h2>
    </div>

    <div class="card">
        <p class="small-text"><strong>Seu link de convite</strong></p>
        <input type="text" id="inviteLink" readonly>
        <button onclick="copiarLink()">üìã Copiar link</button>
    </div>

    <div class="card">
        <div class="stat">üë§ Total <strong id="total">0</strong></div>
        <div class="stat">ü•á N√≠vel 1 <strong id="nivel1">0</strong></div>
        <div class="stat">ü•à N√≠vel 2 <strong id="nivel2">0</strong></div>
        <div class="stat">ü•â N√≠vel 3 <strong id="nivel3">0</strong></div>
    </div>

    <div class="card">
        <h2>üí∞ Ganhos Autom√°ticos</h2>

        <p class="small-text">
            Indique novos usu√°rios e receba comiss√µes autom√°ticas
            sobre os investimentos realizados na sua rede.
        </p>

        <hr>

        <p class="small-text"><strong>üîó Comiss√µes por n√≠vel</strong></p>
        <p class="small-text">
            N√≠vel 1: <strong>20%</strong><br>
            N√≠vel 2: <strong>5%</strong><br>
            N√≠vel 3: <strong>3%</strong>
        </p>

        <hr>

        <p class="small-text"><strong>üìä Exemplo</strong></p>
        <p class="small-text">
            100 pessoas investindo R$ 85<br>
            Total: <strong>R$ 8.500</strong><br>
            Seu lucro:30% <strong>R$ 1.700</strong>
        </p>

        <hr>

        <p class="small-text">
            üöÄ Ganhos mensais podem ultrapassar <strong>R$ 3.000</strong>
            conforme o crescimento da rede.
        </p>
    </div>

</div>

<script>
// ===== Firebase + fallback =====
const firebaseScriptApp = document.createElement('script');
firebaseScriptApp.src = 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js';
document.head.appendChild(firebaseScriptApp);

const firebaseScriptAuth = document.createElement('script');
firebaseScriptAuth.src = 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js';
document.head.appendChild(firebaseScriptAuth);

const firebaseScriptFs = document.createElement('script');
firebaseScriptFs.src = 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js';
document.head.appendChild(firebaseScriptFs);

function generateShortCodeFromUid(uid){
    let h = 0;
    for(let i=0;i<uid.length;i++){
        h = ((h << 5) - h) + uid.charCodeAt(i);
        h |= 0;
    }
    const num = Math.abs(h) % 100000000;
    return 'mgx-pt' + String(num).padStart(8,'0');
}

function generateRandomShortCode(){
    return 'mgx-pt' + String(Math.floor(Math.random()*100000000)).padStart(8,'0');
}

firebaseScriptFs.onload = () => {
    const firebaseConfig = {
        apiKey: "AIzaSyAcVPgUHbL4N9U1-H68klmGKWQF-YGleyc",
        authDomain: "vastbitloud-2872a.firebaseapp.com",
        projectId: "vastbitloud-2872a",
        storageBucket: "vastbitloud-2872a.firebasestorage.app",
        messagingSenderId: "952931184412",
        appId: "1:952931184412:web:ee2a0e38826c30dd0cd4d9"
    };

    try{
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        auth.onAuthStateChanged(async user=>{
            if(user){
                const ref = db.collection('users').doc(user.uid);
                const snap = await ref.get();
                let codigo = generateShortCodeFromUid(user.uid);

                if(snap.exists && snap.data().codigoConvite){
                    codigo = snap.data().codigoConvite;
                }else{
                    ref.set({ codigoConvite: codigo }, { merge:true });
                }

                const d = snap.exists ? snap.data() : {};
                document.getElementById('nivel1').innerText = d.nivel1 || 0;
                document.getElementById('nivel2').innerText = d.nivel2 || 0;
                document.getElementById('nivel3').innerText = d.nivel3 || 0;
                document.getElementById('total').innerText =
                    (d.nivel1||0)+(d.nivel2||0)+(d.nivel3||0);

                document.getElementById('userId').innerText = codigo;
                document.getElementById('inviteLink').value =
                    `https://magaxia.github.io/magaxia/?ref=${codigo}`;
            }else{
                setupLocalFallback();
            }
        });

    }catch(e){
        setupLocalFallback();
    }
};

function setupLocalFallback(){
    if(!localStorage.getItem('userId')){
        localStorage.setItem('userId', generateRandomShortCode());
    }
    const id = localStorage.getItem('userId');
    document.getElementById('userId').innerText = id;
    document.getElementById('inviteLink').value =
        `https://magaxia.github.io/magaxia/?ref=${id}`;
}

function copiarLink(){
    const campo = document.getElementById('inviteLink');
    campo.select();
    document.execCommand('copy');
    alert('Link copiado com sucesso!');
}
</script>

</body>
</html>