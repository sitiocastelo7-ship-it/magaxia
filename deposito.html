<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dep√≥sito ‚Ä¢ Magaxia</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<!-- QRCode -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap');

*{
    margin:0;
    padding:0;
    box-sizing:border-box;
}

body{
    min-height:100vh;
    font-family:'Poppins',sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
    background-attachment:fixed;
    display:flex;
    align-items:center;
    justify-content:center;
    color:white;
    visibility:hidden;
    position:relative;
    overflow:hidden;
}

body::before{
    content:'';
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:radial-gradient(circle at 20% 50%, rgba(102, 126, 234, 0.4) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(240, 147, 251, 0.4) 0%, transparent 50%);
    pointer-events:none;
    animation:float 15s ease-in-out infinite;
}

@keyframes float{
    0%, 100%{transform:translate(0, 0)}
    50%{transform:translate(20px, -20px)}
}

.container{
    padding:40px 20px;
    max-width:500px;
    width:100%;
    text-align:center;
    position:relative;
    z-index:1;
    animation:slideIn 0.6s ease-out;
}

@keyframes slideIn{
    from{
        opacity:0;
        transform:translateY(30px);
    }
    to{
        opacity:1;
        transform:translateY(0);
    }
}

.logo{
    max-width:150px;
    margin:0 auto 30px;
    filter:drop-shadow(0 8px 16px rgba(0,0,0,0.2));
    transition:transform 0.3s ease;
}

.logo:hover{
    transform:scale(1.05);
}

h1{
    font-size:3.2rem;
    font-weight:800;
    letter-spacing:2px;
    margin-bottom:10px;
    text-shadow:0 4px 20px rgba(0,0,0,0.3);
    background:linear-gradient(90deg,#ffffff,#e0e7ff);
    background-clip:text;
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
}

p{
    font-size:1.1rem;
    opacity:0.9;
    font-weight:300;
    letter-spacing:0.5px;
}

.card{
    margin-top:40px;
    background:rgba(255,255,255,0.12);
    backdrop-filter:blur(10px);
    -webkit-backdrop-filter:blur(10px);
    padding:40px 30px;
    border-radius:30px;
    border:1px solid rgba(255,255,255,0.2);
    box-shadow:0 20px 60px rgba(0,0,0,0.25);
    transition:all 0.3s ease;
}

.card:hover{
    background:rgba(255,255,255,0.15);
    border-color:rgba(255,255,255,0.3);
    box-shadow:0 25px 75px rgba(0,0,0,0.35);
}

.valores{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:12px;
    margin-top:20px;
    margin-bottom:25px;
}

.valor-btn{
    padding:14px;
    border-radius:15px;
    border:2px solid rgba(255,255,255,0.2);
    cursor:pointer;
    background:rgba(255,255,255,0.08);
    color:white;
    font-weight:600;
    font-size:0.95rem;
    transition:all 0.3s ease;
    position:relative;
    overflow:hidden;
}

.valor-btn::before{
    content:'';
    position:absolute;
    top:0;
    left:-100%;
    width:100%;
    height:100%;
    background:linear-gradient(90deg,#39c6ff,#b84cff);
    transition:left 0.3s ease;
    z-index:-1;
}

.valor-btn:hover{
    border-color:rgba(255,255,255,0.4);
    color:white;
    transform:translateY(-2px);
    box-shadow:0 10px 25px rgba(57,198,255,0.3);
}

.valor-btn:hover::before{
    left:0;
}

input{
    width:100%;
    padding:16px 20px;
    margin-top:15px;
    border-radius:15px;
    border:2px solid rgba(255,255,255,0.2);
    background:rgba(255,255,255,0.08);
    color:white;
    text-align:center;
    font-family:'Poppins',sans-serif;
    font-size:1rem;
    transition:all 0.3s ease;
}

input::placeholder{
    color:rgba(255,255,255,0.6);
}

input:focus{
    outline:none;
    border-color:rgba(255,255,255,0.5);
    background:rgba(255,255,255,0.12);
    box-shadow:0 0 20px rgba(57,198,255,0.3);
}

button{
    width:100%;
    padding:16px;
    margin-top:15px;
    border-radius:15px;
    border:none;
    text-align:center;
    font-family:'Poppins',sans-serif;
    font-weight:600;
    font-size:1rem;
    cursor:pointer;
    background:linear-gradient(135deg,#39c6ff,#b84cff);
    color:white;
    transition:all 0.3s ease;
    position:relative;
    overflow:hidden;
    box-shadow:0 8px 25px rgba(57,198,255,0.3);
}

button::after{
    content:'';
    position:absolute;
    top:50%;
    left:50%;
    width:0;
    height:0;
    background:rgba(255,255,255,0.3);
    border-radius:50%;
    transform:translate(-50%, -50%);
    transition:width 0.6s, height 0.6s;
}

button:hover{
    transform:translateY(-4px);
    box-shadow:0 12px 35px rgba(57,198,255,0.4);
}

button:active::after{
    width:300px;
    height:300px;
}

#qrcode{
    margin-top:25px;
    display:flex;
    justify-content:center;
}

#qrcode img,
#qrcode canvas{
    border-radius:15px;
    box-shadow:0 10px 40px rgba(0,0,0,0.3);
    transition:transform 0.3s ease;
}

#qrcode:hover img,
#qrcode:hover canvas{
    transform:scale(1.02);
}

#pix-area{
    margin-top:20px;
    animation:slideIn 0.4s ease-out;
}

#pixCode{
    width:100%;
    padding:14px;
    border-radius:12px;
    border:2px solid rgba(255,255,255,0.2);
    background:rgba(255,255,255,0.08);
    color:white;
    resize:none;
    font-family:monospace;
    font-size:0.85rem;
    transition:all 0.3s ease;
}

#pixCode:focus{
    outline:none;
    border-color:rgba(255,255,255,0.4);
    background:rgba(255,255,255,0.12);
}

.info{
    margin-top:20px;
    font-size:0.95rem;
    opacity:0.85;
    line-height:1.6;
    font-weight:300;
}

.back{
    margin-top:35px;
    font-size:1rem;
    opacity:0.8;
    cursor:pointer;
    transition:all 0.3s ease;
    font-weight:500;
    display:inline-block;
}

.back:hover{
    opacity:1;
    transform:translateX(-5px);
}

@media(max-width:480px){
    .container{padding:20px}
    h1{font-size:2.2rem}
    .card{padding:25px 20px}
    .valores{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>

<body>

<div class="container">
    <h1>üíé DEP√ìSITO</h1>
    <p>Escolha um valor e pague via Pix</p>

    <div class="card">

        <!-- BOT√ïES DE VALOR FIXO -->
        <div class="valores">
            <button class="valor-btn" onclick="setValor(10)">R$ 10</button>
            <button class="valor-btn" onclick="setValor(20)">R$ 20</button>
            <button class="valor-btn" onclick="setValor(30)">R$ 30</button>
            <button class="valor-btn" onclick="setValor(65)">R$ 65</button>
            <button class="valor-btn" onclick="setValor(85)">R$ 85</button>
            <button class="valor-btn" onclick="setValor(100)">R$ 100+</button>
        </div>

        <input type="number" id="valor" placeholder="üí∞ Digite outro valor (R$)" min="1">

        <button onclick="gerarPix()">üì≤ Gerar QR Code Pix</button>

        <div id="pix-area" style="display:none; margin-top:12px; text-align:left;">
            <!-- Salve a foto que voc√™ enviou como 'pix-10.png' na mesma pasta deste HTML para que ela apare√ßa aqui. -->
            <textarea id="pixCode" readonly style="width:100%; padding:10px; border-radius:10px; resize:none; height:74px;"></textarea>
        <button id="copyPixBtn" onclick="copyPixCode()" style="margin-top:10px;">üìã Copiar c√≥digo Pix</button>
        </div>

        <button onclick="confirmar()">‚úÖ J√° fiz o Pix</button>

        <div class="info">
            ‚è±Ô∏è O saldo ser√° creditado ap√≥s aprova√ß√£o do administrador
        </div>
    </div>

    <div class="back" onclick="window.location.href='index.html'">
        ‚Üê Voltar ao Menu
    </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAcVPgUHbL4N9U1-H68klmGKWQF-YGleyc",
  authDomain: "vastbitloud-2872a.firebaseapp.com",
  projectId: "vastbitloud-2872a"
};
if(!firebase.apps.length) firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

let uid = null;
let valorAtual = 0;

// üîê Login
auth.onAuthStateChanged(user=>{
    if(!user){ location.href="login.html"; return;}
    uid = user.uid;
    document.body.style.visibility="visible";
});

// üéØ DEFINIR VALOR PELO BOT√ÉO
function setValor(v){
    valorAtual = v;
    document.getElementById("valor").value = v;
}

// Mant√©m `valorAtual` sincronizado com o campo de input quando o usu√°rio digita
document.addEventListener('DOMContentLoaded', ()=>{
    const inp = document.getElementById('valor');
    if(inp){
        inp.addEventListener('input', (e)=>{
            const n = Number(e.target.value) || 0;
            valorAtual = n;
        });
    }
});

// üî≥ GERAR PIX
function gerarPix(){
    // Ler o valor atual diretamente do input (garante que digita√ß√£o funcione)
    const inp = document.getElementById('valor');
    if(inp){
        const parsed = Number(inp.value);
        if(!isNaN(parsed)) valorAtual = parsed;
    }

    if(valorAtual <= 0){
        alert("Selecione um valor");
        return;
    }

    const pixArea = document.getElementById("pix-area");
    if(pixArea) pixArea.style.display = "none";

    // Caso especial: quando o valor for R$10, redirecionar para a URL de checkout
    if(Number(valorAtual) === 10){
        window.location.href = "https://pixgo.org/recurrence/checkout.php?id=392";
        return;
    }

    // Caso especial: quando o valor for R$20, redirecionar para a URL de checkout
    if(Number(valorAtual) === 20){
        window.location.href = "https://pixgo.org/recurrence/checkout.php?id=431";
        return;
    }

    // Caso especial: quando o valor for R$30, redirecionar para a URL de checkout
    if(Number(valorAtual) === 30){
        window.location.href = "https://pixgo.org/recurrence/checkout.php?id=432";
        return;
    }

    // Caso especial: quando o valor for R$65, redirecionar para a URL de checkout
    if(Number(valorAtual) === 65){
        window.location.href = "https://pixgo.org/recurrence/checkout.php?id=433";
        return;
    }

    // Caso especial: quando o valor for R$85, redirecionar para a URL de checkout
    if(Number(valorAtual) === 85){
        window.location.href = "https://pixgo.org/recurrence/checkout.php?id=434";
        return;
    }

    // Caso especial: quando o valor for R$100, redirecionar para a URL de checkout
    if(Number(valorAtual) === 100){
        window.location.href = "https://pixgo.org/recurrence/checkout.php?id=435";
        return;
    }

    // Comportamento padr√£o para outros valores (gera QR com payload simples)
    const payloadPix = `PIX|VALOR:${valorAtual}|UID:${uid}`;
}

// Copiar o c√≥digo Pix para a √°rea de transfer√™ncia
function copyPixCode(){
    const pixCode = document.getElementById('pixCode').value;
    if(!pixCode) return;
    navigator.clipboard.writeText(pixCode).then(()=>{
        alert('C√≥digo Pix copiado!');
    }).catch(()=>{
        // Fallback quando o clipboard n√£o estiver dispon√≠vel
        const input = document.createElement('input');
        document.body.appendChild(input);
        input.value = pixCode;
        input.select();
        document.execCommand('copy');
        document.body.removeChild(input);
        alert('C√≥digo Pix copiado!');
    });
}

// üíæ REGISTRAR DEP√ìSITO
async function confirmar(){
    if(valorAtual <= 0){
        alert("Selecione um valor primeiro");
        return;
    }

    await db.collection("depositos").add({
        uid,
        valor: valorAtual,
        status: "pendente",
        data: firebase.firestore.FieldValue.serverTimestamp()
    });

    alert("Dep√≥sito registrado! Aguarde aprova√ß√£o.");
    location.reload();
}
</script>

<script>
(function(){
    const fixedQR = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==';

    function createImg(){
        const img = document.createElement('img');
        img.src = fixedQR;
        img.alt = 'QR Code Pix';
        img.width = 200;
        img.height = 200;
        img.style.borderRadius = '15px';
        img.dataset.fixedQr = 'true';
        return img;
    }

    function applyFixed(){
        document.querySelectorAll('#qrcode').forEach(q=>{
            if(!q) return;
            if(q.children && q.children.length > 0) return;
            q.innerHTML = '';
            q.appendChild(createImg());
            q.dataset.fixedQrContainer = 'true';
        });

        document.querySelectorAll('canvas').forEach(c=>{
            if(c.closest && c.closest('#qrcode')) return;
            const img = createImg();
            if(c.parentNode) c.parentNode.replaceChild(img,c);
        });

        document.querySelectorAll('img').forEach(img=>{
            if(img.dataset.fixedQr === 'true') return;
            if(img.closest && img.closest('#qrcode')) return;
            if(/pix-10\.png$/i.test((img.src||'')) || /qr pix r\$10/i.test(img.alt || '')) return;
            if(img.classList.contains('qrcode') || img.id==='qrcode' || img.dataset.qr !== undefined || /qr/i.test(img.alt || '')){
                img.src = fixedQR;
                img.dataset.fixedQr = 'true';
            }
        });
    }

    applyFixed();
    const mo = new MutationObserver(()=> applyFixed());
    mo.observe(document.body, { childList: true, subtree: true, attributes: true, attributeFilter: ['src','data-value'] });
})();
</script>

</body>
</html>