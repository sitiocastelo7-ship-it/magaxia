<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Cadastro - TESTE FINAL 100%</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    background:#0f172a;
    color:#fff;
    font-family:Arial,Helvetica,sans-serif;
    text-align:center;
}
.container{
    max-width:420px;
    margin:auto;
    padding:40px 20px;
}
input,button{
    width:100%;
    padding:14px;
    margin-top:12px;
    border-radius:12px;
    border:none;
    font-size:0.95rem;
}
button{
    background:#22c55e;
    font-weight:bold;
    cursor:pointer;
}
input[readonly]{
    opacity:.7;
    background:#1e293b!important;
}
.msg{
    margin-top:10px;
    font-size:.9rem;
    color:#38bdf8;
}
#status-badge {
    position:fixed; 
    top:10px; 
    right:10px; 
    z-index:9999; 
    padding:10px 15px; 
    border-radius:8px; 
    font-weight:bold; 
    font-size:13px;
}
</style>
</head>

<body>
<div id="status-badge">ðŸ”„ Processando...</div>

<div class="container">
    <h1>Criar Conta [TESTE FINAL]</h1>

    <input type="text" id="nome" placeholder="Nome completo">
    <input type="tel" id="telefone" placeholder="Telefone (ex: +5511999999999)">
    <input type="password" id="senha" placeholder="Senha">
    <input type="password" id="confirmSenha" placeholder="Confirmar senha">
    <input type="text" id="codigoConvite" placeholder="CÃ³digo de convite (opcional)">

    <div id="msgConvite" class="msg"></div>

    <button onclick="cadastrar()">Cadastrar</button>

    <p style="margin-top:10px;color:#cbd5e1">
        JÃ¡ tem conta? <a href="login.html" style="color:#60a5fa">Entrar</a>
    </p>
</div>

<script>

// ===============================
// ðŸ”— AUTO PREENCHIMENTO VIA LINK
// ===============================
async function preencherConvite(){
    const badge = document.getElementById("status-badge");
    
    const url = new URL(window.location.href);
    const refParam = url.searchParams.get("ref");
    const inviteParam = url.searchParams.get("invite");
    const paramValue = refParam || inviteParam;
    const paramKey = refParam ? "ref" : (inviteParam ? "invite" : null);

    console.log("ðŸ”„ paramValue:", paramValue);

    if(paramValue){
        const campo = document.getElementById("codigoConvite");
        const msgDiv = document.getElementById("msgConvite");
        
        // Preenche o campo IMEDIATAMENTE
        if(campo){
            campo.value = paramValue;
            campo.readOnly = true;
            console.log("âœ… Campo preenchido com:", paramValue);
            badge.textContent = "âœ… PREENCHIDO com: " + paramValue.substring(0, 10) + "...";
            badge.style.background = "#22c55e";
            badge.style.color = "#000";
        }

        // Mostra mensagem de validaÃ§Ã£o
        if(msgDiv){
            msgDiv.innerText = "âœ… AUTO-PREENCHIMENTO FUNCIONANDO PERFEITAMENTE!";
        }
    } else {
        badge.textContent = "âš ï¸ Nenhum parÃ¢metro ?ref=";
        badge.style.background = "#f59e0b";
        badge.style.color = "#000";
    }
}

// Executa com delay para garantir que DOM estÃ¡ pronto
setTimeout(() => {
    console.log("ðŸš€ Chamando preencherConvite()");
    preencherConvite();
}, 100);

async function cadastrar(){
    alert("Teste - FormulÃ¡rio funcionando!");
}

</script>
</body>
</html>
